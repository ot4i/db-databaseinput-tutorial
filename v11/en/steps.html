<!DOCTYPE html>
<html class="no-js" lang="en">
 
	
<!-- header::Start -->
	<head>
		<!-- Use Internet Explorer 9 Standards mode for Eclipse Browser Control - https://www.eclipse.org/swt/faq.php#browsernativeie and https://msdn.microsoft.com/en-us/library/jj676915%28v=vs.85%29.aspx -->
  		<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
		
		<!-- Next 2 http=equiv headers required to disable caching the Eclipse Browser Widget -->
		<meta http-equiv="Pragma" content="no-cache">
  		<meta http-equiv="Expires" content="-1">

		<meta charset="UTF-8"> 
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<meta name="copyright" content="Copyright IBM Corporation 2014" />
		<meta name="abstract" content="IBM App Connect Enterprise V11 Tutorial">
		<meta name="author" content="IBM">
		<meta name="description" content="IBM App Connect Enterprise V11 Tutorial">
		<meta name="keywords" content="keywords" > 
		<meta name="robots" content="index,follow">
		<meta name="source" content="IBM App Connect Enterprise V11 Tutorial" /> 
		
		<title>IBM App Connect Enterprise V11 Tutorial</title>

    	<link rel="stylesheet" href="https://ot4i.github.io/iib-tutorials/css/main.css" />
		<link rel="stylesheet" href="https://ot4i.github.io/iib-tutorials/css/app.css" />
    	
		<script src="https://ot4i.github.io/iib-tutorials/js/json2.js"></script>
		<script src="https://ot4i.github.io/iib-tutorials/js/js2java.js"></script>
		<script src="https://ot4i.github.io/iib-tutorials/js/js2java_steps.js"></script>
		<script src="https://ot4i.github.io/iib-tutorials/js/vendor/modernizr.js"></script>
	</head>
<!-- header::End -->
<!-- body::Start -->
		<body>
  	<!-- body content here -->
	<div class="row">
	  <div class="small-12 medium-12 large-12 columns">
	    <p> </p>
	  </div>
	</div>
	<div class="row">
	  <div class="small-9 medium-9 large-9 columns">
	    <h4 class="title">Databases - Using a DatabaseInput node to trigger a flow on insert into DB2 via ODBC <action><button class="small radius button" tabindex="0" id="stepsViewDetails" onclick="viewDetails()"> View Details</button> </action></h4>
	  </div>
	  <div class="small-3 medium-3 large-3 columns">
		<a href="javascript:;" onclick="openExternalBrowser('https://www.ibm.com/support/knowledgecenter/en/SSTTDS_11.0.0/com.ibm.ace.home.doc/help_home.htm')" class="small right helplink">IBM Knowledge Center</a> 
	  </div>
	</div> 
	<hr>
	<div class="row">
		<div class="small-10 medium-10 large-10 columns">
		<h5> Learn how to use a DatabaseInput node to trigger a flow when data is inserted into DB2. </h5>
		</div>
		<div class="small-2 medium-2 large-2 columns">
			<button class="small radius button right" tabindex="0" id="backToGallery" onclick="backToGallery()"> Back To Gallery
			</button>
		</div>
	</div>
	<div class="row">          
		  <div class="small-12 medium-12 large-12 columns">
			<ul class="tabs vertical"> 
				<li class="tab-title tab-title-small active">
				  <a href="javascript:;" onclick="show('panel21')">Create</a> 
				</li>
				<li class="tab-title tab-title-small">
				  <a href="javascript:;" onclick="show('panel31')">Prepare</a> 
				</li>
				<li class="tab-title tab-title-small">
				  <a href="javascript:;" onclick="show('panel41')">Run</a> 
				</li>
			</ul>
			<!-- editing -->
			<div class="tabs-content panel-thin-blue vertical"> 
		    	<div class="content active" id="panel21">
		    		
		    		<div class="small-10 medium-10 large-10 columns divider">
					
				      	<div class="row content-details">
					      	<h4>Import projects</h4>
					        
						    
								<p> When you click Import, two projects will be created in your workspace: An application named <span class="application">ExampleDatabaseInput</span> and a data design project named <span class="application">ExampleDataDesign</span>. </p>
								
							
								<p> <span class="application">ExampleDatabaseInput</span> provides a single message flow named <span class="resource">DatabaseInput</span> which uses a DatabaseInput node which is triggered when a new row is created in a nominated Event table. The Event table row is created by a DB2 Trigger, whenever a new row is inserted into an Application table. Once the message flow is triggered it will simply propagate data to a FileOutput node which is configured to write a simple JSON message to the file system. </p>
								
							
								<p> Once imported using the link on the right, the provided projects are ready to be deployed and tested. The projects will be deployed to the integration server using a provided BAR file. Before you do this, you will need to create the required DB2 database tables and trigger, as described on the Prepare tab. </p>
								
							
						</div>
						
						<div class="row content-details">
							<h4>Find out more</h4>
							<ul>
							
								
								
								<li> <a href="javascript:;" onclick="openExternalBrowser('https://www.ibm.com/support/knowledgecenter/en/SSTTDS_11.0.0/com.ibm.etools.mft.doc/bi12002_.htm')" title="Knowledge Center link to  Developing integration solutions by using applications">Developing integration solutions by using applications</a> </li>
									
							
							</ul>
						</div>
						
					</div>
					
					<div class="small-2 medium-2 large-2 columns">
					
					
					<h4 class="tkaction"><a href="javascript:;" onclick="importArtifacts(); openResource('MainFlow')"> Import <img class="icon-image" src="https://ot4i.github.io/iib-tutorials/images/icons/ibmdesign/back-right-previous_128-orange.png"></a></h4>
										
				    </div>
					
		    	</div>
		    	<div class="content" id="panel31">
					
					<div class="small-12 medium-12 large-12 columns">
					
						<div class="row content-details">
						  	<h4>Prepare the database, set up your credentials, create the output directory and deploy</h4>
						    
						    
								<p> This tutorial uses DB2 to create a database, which the App Connect Enterprise message flow will interact with. It is assumed you have DB2 already installed successfully, and that you have access to a userid which has the required level of DB2 administrative privileges. Create a new example database for this tutorial named USERS: </p>
								
								
									
									<ol>
									
									
										<li> Start a DB2 Command Window and execute the command:<br><code><span class="cmdname">db2 create database USERS</span></code>
										
										</li>
									
										<li> Next we will connect to the database which was just created and create two tables and a trigger. From the same window, start an interactive command session by typing <code><span class="cmdname">db2</span></code> and then execute these commands:<br><code><span class="cmdname">CONNECT TO USERS</span></code><br><code><span class="cmdname">CREATE TABLE MYSCHEMA.EMPLOYEES (PKEY INTEGER NOT NULL, FIRSTNAME VARCHAR(30), LASTNAME VARCHAR(30), COUNTRY VARCHAR(2), PRIMARY KEY(PKEY))</span></code><br><code><span class="cmdname">CREATE TABLE MYSCHEMA.EVENTS (EVENT_ID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1 INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 NO CYCLE NO CACHE), OBJECT_KEY INTEGER NOT NULL, OBJECT_VERB VARCHAR(6), OBJECT_NAME VARCHAR(20), EVENT_PRIORITY INTEGER, EVENT_TIME TIMESTAMP, EVENT_STATUS INTEGER, PRIMARY KEY(EVENT_ID))</span></code><br><code><span class="cmdname">CREATE TRIGGER MYSCHEMA.EMPLOYEES_TRIGGER AFTER INSERT ON MYSCHEMA.EMPLOYEES REFERENCING NEW AS N FOR EACH ROW INSERT INTO MYSCHEMA.EVENTS (OBJECT_KEY, OBJECT_VERB, OBJECT_NAME, EVENT_PRIORITY, EVENT_TIME, EVENT_STATUS) VALUES (N.PKEY,'CREATE','EMPLOYEE',1,CURRENT_TIMESTAMP,0)</span></code>
										
										</li>
									
									
									</ol>
									
								
							
								<p> Set up an ODBC connection in the operating system: </p>
								
								
									
									<ol>
									
									
										<li> This tutorial assumes you are using Windows, but if this is not the case, full instructions are provided for configuring ODBC in the Knowledge Center links at the base of this section. On Windows, open the <span class="resource">ODBC Data Source Administrator (64-bit)</span>, switch to the <span class="resource">System DSN</span> tab, click the Add button, and select a driver for your database.
										
										</li>
									
										<li> Using DB2 in a default set-up, you should find an entry in the list labelled <span class="resource">IBM DB2 ODBC Driver - DB2COPY1</span>. Select this entry and click Finish.
										
										</li>
									
										<li> In the resulting Add dialog, set the <span class="resource">Data source name = USERS</span>, leave the <span class="resource">Database alias = USERS</span> and click OK. You will be returned to the <span class="resource">ODBC Data Source Administrator (64-bit)</span> window and you should clikc OK again to close this window too.
										
										</li>
									
									
									</ol>
									
								
							
								<p> Create an integration node, and set up your credentials by completing the following steps: </p>
								
								
									
									<ol>
									
									
										<li> Start an App Connect Enterprise command console and execute the following commands:<br><code><span class="cmdname">mqsicreatebroker TESTNODE</span></code><br><code><span class="cmdname">mqsistart TESTNODE</span></code><br><code><span class="cmdname">mqsicreateexecutiongroup TESTNODE -e server</span></code><br><code><span class="cmdname">mqsistop TESTNODE</span></code><br><code><span class="cmdname">mqsisetdbparms TESTNODE -n odbc::USERS -u db2admin -p pass123</span></code><br><code><span class="cmdname">mqsistart TESTNODE</span></code>
										
										</li>
									
										<li> The above mqsisetdbparms command configures the runtime with the required credentials to access the USERS database.
										
										</li>
									
									
									</ol>
									
								
							
								<p> Create the required output directory on your file system and then deploy: </p>
								
								
									
									<ol>
									
									
										<li> The message flow assumes a Windows runtime platform will be used and will attempt to write an output file to the directory <code>C:\temp</code>. If you are using Linux, change the <span class="application">Directory</span> property on the <span class="application">Basic</span> tab of the <span class="application">FileOutput</span> node in the message flow <span class="application">DatabaseInput</span>
										
										</li>
									
										<li> If you have changed the flow to use a different directory then rebuild the provided BAR file named <span class="application">DatabaseInput.bar</span> which you will find inside the <span class="application">ExampleDatabaseInput</span> application. Drag and drop deploy the BAR file on to your integration server.
										
										</li>
									
									
									</ol>
									
								
							
						</div>
						
						<div class="row content-details">
							<h4>Find out more</h4>
							<ul>
							
								
								
								<li> <a href="javascript:;" onclick="openExternalBrowser('https://www.ibm.com/support/knowledgecenter/en/SSTTDS_11.0.0/com.ibm.etools.mft.doc/ah14440_.htm')" title="Knowledge Center link to  Enabling ODBC Connections to the databases">Enabling ODBC Connections to the databases</a> </li>
									
							
							</ul>
						</div>
							
					</div>
					
		    	</div>
		    	<div class="content" id="panel41">
		    		
					<div class="small-12 medium-12 large-12 columns">
					
				    	<div class="row content-details">
					      	<h4></h4>
					        
						    
								<p> <h4>Use the Flow Exerciser to test the tutorial scenario </h4></p>
								
								
									
									<ol>
									
									
										<li> Open <span class="resource">DatabaseInput.msgflow</span>.
										
										
											
											<ul>
											
												
													<li> Click the Flow Exerciser icon <img src="http://ot4i.github.io/ot4i.tutorials//dist/images/icons/iib/startFlowExerciser.png" alt> to start testing the flow (when challenged you do not need to redeploy the flow again).</li>
												
													<li> Return to your DB2 Command Window and make an insert into the EMPLOYEES table using this command:<br><code><span class="cmdname">INSERT INTO MYSCHEMA.EMPLOYEES (PKEY, FIRSTNAME, LASTNAME, COUNTRY) VALUES (1, 'Ben', 'Thompson', 'GB')</span></code></li>
												
													<li> Click the View Path icon <img src="http://ot4i.github.io/ot4i.tutorials//dist/images/icons/iib/viewPath.png" alt> to show the path taken through the message flow. This should show a green line highlighting that the DatabaseInput node propagated data to the FileOutput node.</li>
												
													<li> Check the output directory <span class="resource">C:\temp</span> and you should find an output file named <span class="resource">Output.xml</span> has been created which contains this data:<br><span class="resource">&lt;NS1:EMPLOYEES xmlns:NS1="http://users/myschema"&gt;&lt;PKEY&gt;1&lt;/PKEY&gt;&lt;FIRSTNAME&gt;Ben&lt;/FIRSTNAME&gt;&lt;LASTNAME&gt;Thompson&lt;/LASTNAME&gt;&lt;COUNTRY&gt;GB&lt;/COUNTRY&gt;&lt;/NS1:EMPLOYEES&gt;</span></li>
												
													<li> You may wish to explore the row entry which has been left in the EVENTS table. Once an event record has been processed, its EVENT_STATUS column will be updated from the value 0 to the value 1. </li>
												
											
											</ul>
											
										
										</li>
									
									
									</ol>
									
								
							
								<p> This tutorial has shown the DatabaseInput node which communicates with a DB2 database using ODBC in order to be triggered when data is inserted. </p>
								
							
						</div>
						
						<div class="row content-details"> 	
							<h4>Find out more</h4>
							<ul>
							
								
								
								<li> <a href="javascript:;" onclick="openExternalBrowser('https://www.ibm.com/support/knowledgecenter/en/SSTTDS_11.0.0/com.ibm.etools.mft.doc/bc34042_.htm')" title="Knowledge Center link to  Configuring a DatabaseInput node">Configuring a DatabaseInput node</a> </li>
									
							
								
								
								<li> <a href="javascript:;" onclick="openExternalBrowser('https://www.ibm.com/support/knowledgecenter/en/SSTTDS_11.0.0/com.ibm.etools.mft.doc/rt26110_.htm')" title="Knowledge Center link to  Testing your message flow by using the Flow exerciser">Testing your message flow by using the Flow exerciser</a> </li>
									
							
							</ul>
						</div>
							
					</div>
					
				</div>	
			</div> <!-- tab-content -->
		</div> <!-- columns -->
	  </div> <!-- row --></body>
		<script src="https://ot4i.github.io/iib-tutorials/js/vendor/jquery.js"></script>
		<script src="https://ot4i.github.io/iib-tutorials/js/vendor/foundation.min.js"></script>
		<script src="https://ot4i.github.io/iib-tutorials/js/main.js"></script>
	</body>
<!-- body::End -->

</html>